name: CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Setup
      uses: actions/setup-go@v1
      with:
        go-version: 1.12
      id: go
    - name: Checkout
      uses: actions/checkout@v1
    - name: Install
      run: |
        go get -v -t -d ./...
        make deps
      env:
        CC_VERSION: 'latest'
        GO111MODULE: 'on'
    - name: Lint
      run: PATH="$(go env GOPATH)/bin:$PATH" make lint
    - name: Test
      run: make cover
    - name: SonarCloud
      uses: sonarsource/sonarcloud-github-action@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
    - name: Build
      run: PATH="$(go env GOPATH)/bin:$PATH" VERSION=${GITHUB_REF} make build
      env:
        CI: true
    - name: Deploy
      uses: docker://softprops/action-gh-release
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: build/chrome-bookmarks.alfredworkflow
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
